/*! someAvatar 0.0.1 2017-07-20  WaterTian */

function init(){container=document.createElement("div"),document.body.appendChild(container),scene=new THREE.Scene,scene.fog=new THREE.Fog(0,400,1800);var a=new THREE.AmbientLight(8947848,1);scene.add(a);var b=new THREE.DirectionalLight(13421772,1);b.color.setHSL(.1,1,.95),b.position.set(1,1.75,1),b.position.multiplyScalar(50),scene.add(b),renderer=new THREE.WebGLRenderer({antialias:!0}),renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(window.innerWidth,window.innerHeight),renderer.setClearColor(new THREE.Color(2560311)),container.appendChild(renderer.domElement),renderer.gammaInput=!0,renderer.gammaOutput=!0,renderer.shadowMap.enabled=!0,camera=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,4e4),camera.position.set(0,8e3,8e3),scene.add(camera),controls=new THREE.TyOrbitControls(camera,renderer.domElement),controls.target.set(0,Floor+60,0),controls.update(),TY.ThreeContainer=new THREE.Group,scene.add(TY.ThreeContainer),intoIntor(),composer=new THREE.EffectComposer(renderer),composer.addPass(new THREE.RenderPass(scene,camera)),FilmEffect=new THREE.FilmPass(.35,0,2048,!1),composer.addPass(FilmEffect),WaterEffect=new THREE.WaterPass,composer.addPass(WaterEffect),InkEffect=new THREE.InkPass,composer.addPass(InkEffect);var c=new THREE.TexturePass((new THREE.TextureLoader).load("assets/img/vignette.png"),.9);c.renderToScreen=!0,composer.addPass(c),window.addEventListener("resize",onWindowResize,!1)}function changeEffect(){1==effectType&&(WaterEffect.renderToScreen=!0,FilmEffect.renderToScreen=!1),2==effectType&&(WaterEffect.renderToScreen=!1,FilmEffect.renderToScreen=!1,InkEffect.renderToScreen=!0),3==effectType&&(WaterEffect.renderToScreen=!1,FilmEffect.renderToScreen=!0,InkEffect.renderToScreen=!1,FilmEffect.setUniforms(.35,.99,2048,!0)),4==effectType&&(WaterEffect.renderToScreen=!0,FilmEffect.renderToScreen=!1),5==effectType&&(WaterEffect.renderToScreen=!1,FilmEffect.renderToScreen=!1,InkEffect.renderToScreen=!0),6==effectType&&(WaterEffect.renderToScreen=!1,FilmEffect.renderToScreen=!0,InkEffect.renderToScreen=!1,FilmEffect.setUniforms(.35,0,648,!1)),TY.H5Sound.play("l"+Math.floor(6*Math.random()+1),1),effectType%2==0?controls.moveIn(3,200*Math.random()-100,Floor+100,400):controls.moveIn(3,1e3*Math.random()-500,600*Math.random(),400+1e3*Math.random()),++effectType>6&&(effectType=1)}function intoIntor(){function a(){console.log("sounds loaded"),TY.H5Sound.play("bg",0),controls.addEventListener("touchEnd",intoStage),controls.addEventListener("clickScene",intoStage),controls.addEventListener("yao",intoStage)}initSky(),initSnows(),L1=new TY.Light2(new THREE.IcosahedronGeometry(30,5)),L1.position.set(0,Floor+100,0),TY.ThreeContainer.add(L1),TweenMax.to(L1.scale,3,{x:80,y:80,z:80});var b=new THREE.MeshLambertMaterial({map:(new THREE.TextureLoader).load("assets/img/logo.png"),transparent:!0,opacity:0,fog:!1,side:THREE.DoubleSide});logo=new THREE.Mesh(new THREE.PlaneGeometry(2e3,2e3,4,4),b),logo.position.set(0,1600,1600),logo.rotation.set(-Math.PI/4,0,0),scene.add(logo),TweenMax.to(b,2,{opacity:1,delay:1});var c=[{src:TY.baseURL+"assets/sound/bg.mp3",id:"bg"},{src:TY.baseURL+"assets/sound/intro.mp3",id:"intro"},{src:TY.baseURL+"assets/sound/intro2.mp3",id:"intro2"},{src:TY.baseURL+"assets/sound/l1.mp3",id:"l1"},{src:TY.baseURL+"assets/sound/l2.mp3",id:"l2"},{src:TY.baseURL+"assets/sound/l3.mp3",id:"l3"},{src:TY.baseURL+"assets/sound/l4.mp3",id:"l4"},{src:TY.baseURL+"assets/sound/l5.mp3",id:"l5"},{src:TY.baseURL+"assets/sound/l6.mp3",id:"l6"}];TY.H5Sound.load(c,a)}function intoStage(){controls.removeEventListener("touchEnd",intoStage),controls.removeEventListener("clickScene",intoStage),controls.removeEventListener("yao",intoStage),TY.H5Sound.play("intro",1),controls.enabled=!1,TweenMax.to(L1.scale,5,{x:.1,y:.1,z:.1,ease:Strong.easeInOut,onComplete:function(){TY.ThreeContainer.remove(L1),L1=new TY.Light2(new THREE.IcosahedronGeometry(16,2)),L1.position.set(0,Floor+120,0),TY.ThreeContainer.add(L1),L1.MoveAble=!0,initGround()}}),TweenMax.to(logo.material,3,{opacity:0,delay:4});var a=document.getElementById("logo");a.style.display="block",TweenMax.from(a,1,{opacity:0,delay:4}),controls.moveIn(9,0,Floor+200,600,function(){controls.enabled=!0,controls.minDistance=100,controls.maxDistance=2e3,controls.minPolarAngle=.2*Math.PI,controls.maxPolarAngle=.48*Math.PI,logo.material.opacity=.8,initTrees(),loadModel("assets/models/model.js")})}function initSky(){var a=(new THREE.TextureLoader).load("assets/img/starsmap.jpg",function(){var b=new THREE.MeshBasicMaterial({map:a,transparent:!0,opacity:0,fog:!1}),c=new THREE.SphereBufferGeometry(5e3,30,20).toNonIndexed();skyBox=new THREE.Mesh(c,b),skyBox.applyMatrix((new THREE.Matrix4).makeScale(1,1,-1)),TY.ThreeContainer.add(skyBox),TweenMax.to(b,8,{opacity:1,onCompleteParams:[b],onComplete:function(a){a.transparent=!1}});var d=(new THREE.TextureLoader).load("assets/img/fg.png");d.repeat.set(1,1.6);var e=new THREE.MeshBasicMaterial({map:d,transparent:!0,opacity:0,fog:!1}),f=new THREE.SphereBufferGeometry(2200,30,10).toNonIndexed(),g=new THREE.Mesh(f,e);g.position.set(0,1e3,0),skyBox.add(g),TweenMax.to(e,3,{opacity:1,delay:2})})}function initGround(){var a=(new THREE.TextureLoader).load("assets/img/height.jpg",function(){var b=a.image.width,c=a.image.height,d=TY.getImgData(a.image,b,c),e=new THREE.MeshBasicMaterial({color:2001522,map:a}),f=new THREE.PlaneBufferGeometry(2e3,2e3,b-1,c-1);f.rotateX(-Math.PI/2);for(var g=f.attributes.position.array,h=0,i=0,j=d.length;h<j;h+=4,i+=3)g[i+1]=.6*d[h];ground=new THREE.Mesh(f,e),ground.position.set(0,Floor-30,0),TY.ThreeContainer.add(ground);var k=new THREE.Mirror(1e3,1e3,{color:4539717,textureWidth:1e3,textureHeight:1e3});k.rotateX(-Math.PI/2),TY.ThreeContainer.add(k),k.position.set(0,Floor-60,0),TweenMax.to(k.position,2,{y:Floor,ease:Strong.easeOut,delay:1})})}function initTrees(){var a=(new THREE.TextureLoader).load("assets/img/tree.jpg");a.wrapS=a.wrapT=THREE.RepeatWrapping,a.repeat.set(1,10);for(var b=new THREE.MeshPhongMaterial({color:994859,map:a}),c=0;c<70;c++){var d=3e3*(Math.random()-.5),e=3e3*(Math.random()-.5);if(Math.abs(d)>100&&Math.abs(e)>100){var f=Math.random()+1,g=.2*(Math.random()-.5),h=new THREE.CylinderGeometry(2,20*f,2e3*f,10,4),i=new THREE.Mesh(h,b);i.position.set(d,-3e3,e),i.rotation.set(g,g,0),TY.ThreeContainer.add(i),TweenMax.to(i.position,8,{y:500,ease:Strong.easeInOut,delay:.06*c})}}}function initSnows(){snows=new TY.Snows,TY.ThreeContainer.add(snows)}function loadModel(a){var b=function(a){if(a.lengthComputable){var b=a.loaded/a.total*100,c="loading "+Math.round(b,2);console.log(c)}};(new THREE.JSONLoader).load(a,function(a,b){createModel(a,b,0,Floor,0,1)},b)}function createModel(a){function b(){TweenMax.to(d,.1,{rotation:-Math.PI/10,repeat:5,yoyo:!0,delay:1,onComplete:b})}cubeCamera=new THREE.CubeCamera(1,1e4,128),cubeCamera.position.set(0,Floor+100,-50),scene.add(cubeCamera),snows.visible=!1,cubeCamera.updateCubeMap(renderer,scene),snows.visible=!0;var c=new THREE.MeshPhongMaterial({envMap:cubeCamera.renderTarget.texture,skinning:!0});avatar=new TY.Avatar(a,c),avatar.position.set(0,Floor,0),avatar.scale.set(avatarScale,.1,avatarScale),TY.ThreeContainer.add(avatar),avatar.castShadow=!0,avatar.receiveShadow=!0,TweenMax.to(avatar.scale,2,{y:avatarScale,ease:Strong.easeOut}),avatar.addEventListener("playAction",function(a){}),TY.isMobileDevice()?controls.addEventListener("yao",showAvatar):controls.addEventListener("clickScene",showAvatar);var d=new THREE.SpriteMaterial({map:(new THREE.TextureLoader).load("assets/img/yao.png"),blending:THREE.AdditiveBlending,fog:!1});yao=new THREE.Sprite(d),yao.position.set(50,Floor+150,-50),yao.scale.set(40,40,1),TY.ThreeContainer.add(yao),TweenMax.from(yao.scale,1,{x:1,y:1,ease:Elastic.easeOut,delay:2,onComplete:function(){b()}})}function showAvatar(){controls.removeEventListener("yao",showAvatar),controls.removeEventListener("clickScene",showAvatar),TY.H5Sound.play("intro2",1);var a=(new THREE.TextureLoader).load("assets/skins/selfUV.png"),b=new THREE.MeshLambertMaterial({map:a,opacity:1,transparent:!0,side:THREE.DoubleSide,wireframeLinewidth:1,skinning:!0});L1.MoveAble=!1,TweenMax.to(L1,1,{_t:.001}),TweenMax.to(L1.scale,1,{x:20,y:20,z:20,ease:Strong.easeIn,onComplete:function(){TY.ThreeContainer.remove(L1),avatar.material=b,avatar.scale.set(2*avatarScale,2*avatarScale,2*avatarScale),TweenMax.to(avatar.scale,.6,{x:avatarScale,y:avatarScale,z:avatarScale,ease:Strong.easeOut}),avatar.fadeAction(avatar.animateClips[5],1),setTimeout(function(){avatar.fadeAction(avatar.animateClips[2],1)},1500),TY.isMobileDevice()?controls.addEventListener("yao",ChangeStyle):controls.addEventListener("clickScene",ChangeStyle),snows.speed=15,FilmEffect.renderToScreen=!0,FilmEffect.setUniforms(.35,0,648,!1),controls.moveIn(3,0,Floor+100,400)}})}function ChangeStyle(){if(changeAble){changeEffect();var a=Math.floor(7*Math.random()+3);avatar.fadeAction(avatar.animateClips[a],.5),setTimeout(function(){avatar.fadeAction(avatar.animateClips[2],.5)},1500),snows.speed=2*a,changeAble=!1,setTimeout(function(){changeAble=!0},2e3),MtaH5.clickStat("changeStyle")}}function setControlMotions(){var a=!0;controls.touchTarget=avatar,controls.touchTargetCallBack=function(){if(a){switch(console.log("touchCallBack"),removeTip(),_num){case 1:avatar.fadeAction(avatar.animateClips[1],.05),setTimeout(function(){avatar.fadeAction(avatar.animateClips[0],.2)},800);break;case 2:avatar.fadeAction(avatar.animateClips[2],.05),setTimeout(function(){avatar.fadeAction(avatar.animateClips[0],.2)},600);break;case 3:avatar.fadeAction(avatar.animateClips[3],.05),setTimeout(function(){avatar.fadeAction(avatar.animateClips[0],.2)},480)}a=!1,setTimeout(function(){a=!0},1500)}}}function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight),setTimeout(function(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)},1e3)}function animate(){requestAnimationFrame(animate),render(),stats&&stats.update(),snows&&snows.update(),L1&&L1.update()}function render(){var a=clock.getDelta();avatar&&avatar.update(a),renderer.render(scene,camera),composer&&composer.render(a)}THREE.CopyShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")},THREE.FilmShader={uniforms:{tDiffuse:{value:null},time:{value:0},nIntensity:{value:.5},sIntensity:{value:.05},sCount:{value:4096},grayscale:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","uniform float time;","uniform bool grayscale;","uniform float nIntensity;","uniform float sIntensity;","uniform float sCount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 cTextureScreen = texture2D( tDiffuse, vUv );","float dx = rand( vUv + time );","vec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx, 0.0, 1.0 );","vec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );","cResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;","cResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );","if( grayscale ) {","cResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );","}","gl_FragColor =  vec4( cResult, cTextureScreen.a );","}"].join("\n")},THREE.EffectComposer=function(a,b){if(this.renderer=a,void 0===b){var c={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1},d=a.getSize();b=new THREE.WebGLRenderTarget(d.width,d.height,c),b.texture.name="EffectComposer.rt1"}this.renderTarget1=b,this.renderTarget2=b.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.passes=[],void 0===THREE.CopyShader&&console.error("THREE.EffectComposer relies on THREE.CopyShader"),void 0===THREE.ShaderPass&&console.error("THREE.EffectComposer relies on THREE.ShaderPass"),this.copyPass=new THREE.ShaderPass(THREE.CopyShader)},Object.assign(THREE.EffectComposer.prototype,{swapBuffers:function(){var a=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=a},addPass:function(a){this.passes.push(a);var b=this.renderer.getSize();a.setSize(b.width,b.height)},insertPass:function(a,b){this.passes.splice(b,0,a)},render:function(a){var b,c,d=!1,e=this.passes.length;for(c=0;c<e;c++)if(b=this.passes[c],!1!==b.enabled){if(b.render(this.renderer,this.writeBuffer,this.readBuffer,a,d),b.needsSwap){if(d){var f=this.renderer.context;f.stencilFunc(f.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,a),f.stencilFunc(f.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==THREE.MaskPass&&(b instanceof THREE.MaskPass?d=!0:b instanceof THREE.ClearMaskPass&&(d=!1))}},reset:function(a){if(void 0===a){var b=this.renderer.getSize();a=this.renderTarget1.clone(),a.setSize(b.width,b.height)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=a,this.renderTarget2=a.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(a,b){this.renderTarget1.setSize(a,b),this.renderTarget2.setSize(a,b);for(var c=0;c<this.passes.length;c++)this.passes[c].setSize(a,b)}}),THREE.Pass=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1},Object.assign(THREE.Pass.prototype,{setSize:function(a,b){},render:function(a,b,c,d,e){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),THREE.RenderPass=function(a,b,c,d,e){THREE.Pass.call(this),this.scene=a,this.camera=b,this.overrideMaterial=c,this.clearColor=d,this.clearAlpha=void 0!==e?e:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1},THREE.RenderPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.RenderPass,render:function(a,b,c,d,e){var f=a.autoClear;a.autoClear=!1,this.scene.overrideMaterial=this.overrideMaterial;var g,h;this.clearColor&&(g=a.getClearColor().getHex(),h=a.getClearAlpha(),a.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&a.clearDepth(),a.render(this.scene,this.camera,this.renderToScreen?null:c,this.clear),this.clearColor&&a.setClearColor(g,h),this.scene.overrideMaterial=null,a.autoClear=f}}),THREE.ShaderPass=function(a,b){THREE.Pass.call(this),this.textureID=void 0!==b?b:"tDiffuse",a instanceof THREE.ShaderMaterial?(this.uniforms=a.uniforms,this.material=a):a&&(this.uniforms=THREE.UniformsUtils.clone(a.uniforms),this.material=new THREE.ShaderMaterial({defines:a.defines||{},uniforms:this.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader})),this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)},THREE.ShaderPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.ShaderPass,render:function(a,b,c,d,e){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=c.texture),this.quad.material=this.material,this.renderToScreen?a.render(this.scene,this.camera):a.render(this.scene,this.camera,b,this.clear)}}),THREE.FilmPass=function(a,b,c,d){THREE.Pass.call(this),void 0===THREE.FilmShader&&console.error("THREE.FilmPass relies on THREE.FilmShader");var e=THREE.FilmShader;this.uniforms=THREE.UniformsUtils.clone(e.uniforms),this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),void 0!==d&&(this.uniforms.grayscale.value=d),void 0!==a&&(this.uniforms.nIntensity.value=a),void 0!==b&&(this.uniforms.sIntensity.value=b),void 0!==c&&(this.uniforms.sCount.value=c),this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)},THREE.FilmPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.FilmPass,setUniforms:function(a,b,c,d){void 0!==d&&(this.uniforms.grayscale.value=d),void 0!==a&&(this.uniforms.nIntensity.value=a),void 0!==b&&(this.uniforms.sIntensity.value=b),void 0!==c&&(this.uniforms.sCount.value=c)},render:function(a,b,c,d,e){this.uniforms.tDiffuse.value=c.texture,this.uniforms.time.value+=d,this.quad.material=this.material,this.renderToScreen?a.render(this.scene,this.camera):a.render(this.scene,this.camera,b,this.clear)}}),THREE.WaterPass=function(){THREE.Pass.call(this),this.uniforms={u_time:{value:0},u_resolution:{value:new THREE.Vector2(window.innerWidth*window.devicePixelRatio,window.innerHeight*window.devicePixelRatio)},u_mouse:{value:new THREE.Vector2(10,10)},u_texture1:{value:null}},this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:document.getElementById("water_vertexShader").textContent,fragmentShader:document.getElementById("water_fragmentShader").textContent}),this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)},THREE.WaterPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.WaterPass,render:function(a,b,c,d,e){this.uniforms.u_texture1.value=c.texture,this.uniforms.u_time.value+=d,this.quad.material=this.material,this.renderToScreen?a.render(this.scene,this.camera):a.render(this.scene,this.camera,b,this.clear)}}),THREE.InkPass=function(){THREE.Pass.call(this),this.uniforms={u_time:{value:0},u_resolution:{value:new THREE.Vector2(window.innerWidth*window.devicePixelRatio,window.innerHeight*window.devicePixelRatio)},u_mouse:{value:new THREE.Vector2(10,10)},u_texture1:{value:null}},this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:document.getElementById("ink_vertexShader").textContent,fragmentShader:document.getElementById("ink_fragmentShader").textContent}),this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)},THREE.InkPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.InkPass,render:function(a,b,c,d,e){this.uniforms.u_texture1.value=c.texture,this.uniforms.u_time.value+=d,this.quad.material=this.material,this.renderToScreen?a.render(this.scene,this.camera):a.render(this.scene,this.camera,b,this.clear)}}),THREE.TexturePass=function(a,b){THREE.Pass.call(this),void 0===THREE.CopyShader&&console.error("THREE.TexturePass relies on THREE.CopyShader");var c=THREE.CopyShader;this.map=a,this.opacity=void 0!==b?b:1,this.uniforms=THREE.UniformsUtils.clone(c.uniforms),this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,depthTest:!1,depthWrite:!1}),this.needsSwap=!1,this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)},THREE.TexturePass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.TexturePass,render:function(a,b,c,d,e){var f=a.autoClear;a.autoClear=!1,this.quad.material=this.material,this.uniforms.opacity.value=this.opacity,this.uniforms.tDiffuse.value=this.map,this.material.transparent=this.opacity<1,a.render(this.scene,this.camera,this.renderToScreen?null:c,this.clear),a.autoClear=f}}),this.TY=this.TY||{},TY.VERSION="1",TY.Debug=1,TY.baseURL="./",TY.inherit=function(a,b){a.superClass=b,a.prototype=Object.create(b.prototype),a.prototype.constructor=a},TY.extend=function(a,b){if(!b||"object"!=typeof b)return a;for(var c=Object.keys(b),d=c.length;d--;)a[c[d]]=b[c[d]];return a},TY.logBox={},TY.Log=function(a){TY.Debug&&(TY.isMobileDevice&&(TY.logBox.innerHTML+=a+"<br>"),console.log(a))},TY.isAndroid=/Android/i.test(navigator.userAgent),TY.isIphone=/iphone/i.test(navigator.userAgent),TY.isChrome=/chrome\//i.test(navigator.userAgent),TY.isWeixin=/MicroMessenger\//i.test(navigator.userAgent),TY.isWeibo=/Weibo/i.test(navigator.userAgent),TY.isMobileDevice=function(){return!!/(iphone|ios|android|mini|mobile|mobi|nokia|symbian|ipod|ipad|ws\s+phone|mqqbrowser|wp7|wp8|ucbrowser7|ucweb|360\s+aphone\s+browser)/i.test(navigator.userAgent.toLowerCase())},TY.isIosDevice=function(){var a=navigator.userAgent.toLowerCase(),b=!!a.match(/\(i[^;]+;( U;)? cpu.+mac os x/),c=a.indexOf("iphone")>-1||a.indexOf("Mac")>-1,d=a.indexOf("ipad")>-1;return!!(b||d||c)},TY.displacement=function(a,b,c,d){if(a*a+b*b+c*c<2)return new THREE.Vector3(0,0,0);var e=Math.sqrt(a*a+b*b+c*c),f=Math.acos(c/e),g=Math.atan2(b,a);return new THREE.Vector3(3*Math.cos(g)*Math.sin(f)*Math.sin(e-d)/e,3*Math.sin(g)*Math.sin(f)*Math.sin(e-d)/e,3*Math.cos(f)*Math.sin(e-d)/e)},TY.displacement2=function(a,b,c,d){return new THREE.Vector3(Math.sin(a-d),0,0)},TY.displacement3=function(a,b,c,d){if(a*a+b*b+c*c<.01)return new THREE.Vector3(0,0,0);var e=Math.sqrt(a*a+b*b+c*c),f=Math.acos(c/e),g=Math.atan2(b,a);return new THREE.Vector3(3*Math.cos(g)*Math.sin(f)*Math.sin(e-d)/e,3*Math.sin(g)*Math.sin(f)*Math.sin(e-d)/e,3*Math.cos(f)*Math.sin(e-d)/e)},TY.rand=function(a,b,c){return c=0!=c,a=Math.min(a+Math.random()*(b+2-a),b),c?parseInt(a):a},TY.getTexturesFromAtlasFile=function(a,b){for(var c=[],d=0;d<b;d++)c[d]=new THREE.Texture;var e=new Image;return e.onload=function(){for(var a,b,d=e.height,f=0;f<c.length;f++)a=document.createElement("canvas"),b=a.getContext("2d"),a.height=d,a.width=d,b.drawImage(e,d*f,0,d,d,0,0,d,d),c[f].image=a,c[f].needsUpdate=!0},e.src=a,c},TY.getImgData=function(a,b,c){var d=document.createElement("canvas");d.style.display="block",d.id="imgCanvas",document.body.appendChild(d),d.width=b,d.height=c;var e=d.getContext("2d");e.drawImage(a,0,0,b,c,0,0,b,c),e.restore();var f=e.getImageData(0,0,b,c);return document.body.removeChild(d),f.data},TY.EventDispatcher=function(){},TY.EventDispatcher.prototype={constructor:TY.EventDispatcher,addEventListener:function(a,b){return this._listeners?this.removeEventListener(a,b):this._listeners={},this._listeners[a]||(this._listeners[a]=[]),this._listeners[a].push(b),b},hasEventListener:function(a,b){var c=this._listeners;return!(!c||!c[a])},removeEventListener:function(a,b){if(this._listeners&&this._listeners[a])for(var c=this._listeners[a],d=0,e=c.length;d<e;d++)if(c[d]==b){1==e?delete this._listeners[a]:c.splice(d,1);break}},removeAllEventListeners:function(a){a?this._listeners&&delete this._listeners[a]:this._listeners=null},dispatchEvent:function(a,b){var c=!1,d=this._listeners;if(a&&d){var e=d[a];if(!e)return c;e=e.slice();for(var f,g=e.length;g--;){var f=e[g];c=c||f(b)}}return!!c}},THREE.TyOrbitControls=function(a,b){function c(){return 2*Math.PI/60/60*J.autoRotateSpeed}function d(){return Math.pow(.95,J.zoomSpeed)}function e(a){R.theta-=a}function f(a){R.phi-=a}function g(a){J.object instanceof THREE.PerspectiveCamera?S/=a:J.object instanceof THREE.OrthographicCamera?(J.object.zoom=Math.max(J.minZoom,Math.min(J.maxZoom,J.object.zoom*a)),J.object.updateProjectionMatrix(),U=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),J.enableZoom=!1)}function h(a){J.object instanceof THREE.PerspectiveCamera?S*=a:J.object instanceof THREE.OrthographicCamera?(J.object.zoom=Math.max(J.minZoom,Math.min(J.maxZoom,J.object.zoom/a)),J.object.updateProjectionMatrix(),U=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),J.enableZoom=!1)}function i(a){V.set(a.clientX,a.clientY),J.startTouchPoint.set(a.clientX,a.clientY),J.moveTouchPoint.set(0,0)}function j(a){_.set(a.clientX,a.clientY)}function k(a){Y.set(a.clientX,a.clientY)}function l(a){W.set(a.clientX,a.clientY),X.subVectors(W,V);var b=J.domElement===document?J.domElement.body:J.domElement;e(2*Math.PI*X.x/b.clientWidth*J.rotateSpeed),f(2*Math.PI*X.y/b.clientHeight*J.rotateSpeed),V.copy(W),J.moveTouchPoint.copy(X),J.update()}function m(a){aa.set(a.clientX,a.clientY),ba.subVectors(aa,_),ba.y>0?g(d()):ba.y<0&&h(d()),_.copy(aa),J.update()}function n(a){Z.set(a.clientX,a.clientY),$.subVectors(Z,Y),ea($.x,$.y),Y.copy(Z),J.update()}function o(a){J.checkTouchTarget()}function p(a){a.deltaY<0?h(d()):a.deltaY>0&&g(d()),J.update()}function q(a){switch(a.keyCode){case J.keys.UP:ea(0,J.keyPanSpeed),J.update();break;case J.keys.BOTTOM:ea(0,-J.keyPanSpeed),J.update();break;case J.keys.LEFT:ea(J.keyPanSpeed,0),J.update();break;case J.keys.RIGHT:ea(-J.keyPanSpeed,0),J.update()}}function r(a){_.set(a.touches[0].pageX,a.touches[0].pageY),J.startTouchPoint.set(a.touches[0].pageX,a.touches[0].pageY),J.moveTouchPoint.set(0,0)}function s(a){aa.set(a.touches[0].pageX,a.touches[0].pageY),ba.subVectors(aa,_),ba.y>0?h(d()):ba.y<0&&g(d()),_.copy(aa),J.moveTouchPoint.copy(ba),J.update()}function t(a){J.checkTouchTarget()}function u(a){if(!1!==J.enabled){if(a.preventDefault(),a.button===J.mouseButtons.ORBIT){if(!1===J.enableRotate)return;i(a),O=N.ROTATE}else if(a.button===J.mouseButtons.ZOOM){if(!1===J.enableZoom)return;j(a),O=N.DOLLY}else if(a.button===J.mouseButtons.PAN){if(!1===J.enablePan)return;k(a),O=N.PAN}O!==N.NONE&&(document.addEventListener("mousemove",v,!1),document.addEventListener("mouseup",w,!1),J.dispatchEvent(L))}}function v(a){if(!1!==J.enabled)if(a.preventDefault(),O===N.ROTATE){if(!1===J.enableRotate)return;l(a)}else if(O===N.DOLLY){if(!1===J.enableZoom)return;m(a)}else if(O===N.PAN){if(!1===J.enablePan)return;n(a)}}function w(a){!1!==J.enabled&&(o(a),document.removeEventListener("mousemove",v,!1),document.removeEventListener("mouseup",w,!1),J.dispatchEvent(M),O=N.NONE)}function x(a){!1===J.enabled||!1===J.enableZoom||O!==N.NONE&&O!==N.ROTATE||(a.preventDefault(),a.stopPropagation(),p(a),J.dispatchEvent(L),J.dispatchEvent(M))}function y(a){!1!==J.enabled&&!1!==J.enableKeys&&!1!==J.enablePan&&q(a)}function z(a){if(!1!==J.enabled){switch(a.touches.length){case 1:if(!1===J.enableRotate)return;r(a),O=N.TOUCH_DOLLY;break;default:O=N.NONE}O!==N.NONE&&J.dispatchEvent(L)}}function A(a){if(!1!==J.enabled)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:if(!1===J.enableZoom)return;if(O!==N.TOUCH_DOLLY)return;s(a);break;default:O=N.NONE}}function B(a){!1!==J.enabled&&(t(a),J.dispatchEvent(M),O=N.NONE,J.dispatchEvent({type:"touchEnd"}))}function C(a){a.preventDefault()}function D(a){!1!==J.enabled&&(J.deviceOrientation=a,J.update())}function E(){!1!==J.enabled&&(J.screenOrientation=window.orientation||0)}function F(a){if(!1!==J.enabled){var b=a.accelerationIncludingGravity,c=(new Date).getTime();if(c-ga>10){var d=c-ga;ga=c,G=b.x,H=b.y,I=b.z;Math.abs(G+H+I-ha-ia-ja)/d*1e4>fa&&(console.log("摇一摇"),J.dispatchEvent({type:"yao"})),ha=G,ia=H,ja=I}}}this.object=a,this.domElement=void 0!==b?b:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.deviceOrientation={},this.screenOrientation=0,this.getPolarAngle=function(){return Q.phi},this.getAzimuthalAngle=function(){return Q.theta},this.reset=function(){J.target.copy(J.target0),J.object.position.copy(J.position0),J.object.zoom=J.zoom0,J.object.updateProjectionMatrix(),J.dispatchEvent(K),J.update(),O=N.NONE},this.resetToStart=function(){TweenMax.to(J.object.position,1,{x:J.position0.x,y:J.position0.y,z:J.position0.z,ease:Strong.easeInOut,onUpdate:function(){J.update()}})},this.moveIn=function(a,b,c,d,e){TweenMax.to(J.object.position,a,{x:b,y:c,z:d,ease:Strong.easeInOut,onUpdate:function(){J.update()},onComplete:function(){e instanceof Function&&e.call()}})},this.moveOut=function(a){TweenMax.to(J.object.position,1,{x:0,y:30,z:2e3,ease:Strong.easeOut,onUpdate:function(){J.update()},onComplete:function(){a instanceof Function&&a.call()}})},this.touchTargetCallBack=void 0,this.touchTargets=[],this.raycaster=new THREE.Raycaster,this.startTouchPoint=new THREE.Vector2,this.moveTouchPoint=new THREE.Vector2,this.checkTouchTarget=function(){if(0==J.moveTouchPoint.x&&0==J.moveTouchPoint.y){var a=new THREE.Vector2;a.x=J.startTouchPoint.x/window.innerWidth*2-1,a.y=-J.startTouchPoint.y/window.innerHeight*2+1;var b=J.object;J.raycaster.setFromCamera(a,b);for(var c=0;c<J.touchTargets.length;c++){J.raycaster.intersectObject(J.touchTargets[c]).length>0&&J.touchTargetCallBack&&J.touchTargetCallBack(J.touchTargets[c])}J.dispatchEvent({type:"clickScene"})}},this.update=function(){var b=new THREE.Vector3,d=(new THREE.Quaternion).setFromUnitVectors(a.up,new THREE.Vector3(0,1,0)),f=d.clone().inverse(),g=new THREE.Vector3,h=new THREE.Quaternion,i=new THREE.Euler,j=new THREE.Quaternion,k=new THREE.Quaternion(Math.sqrt(.5),0,0,Math.sqrt(.5));return function(){var a=J.deviceOrientation.alpha?THREE.Math.degToRad(J.deviceOrientation.alpha):0,l=J.deviceOrientation.beta?THREE.Math.degToRad(J.deviceOrientation.beta):0,m=J.deviceOrientation.gamma?THREE.Math.degToRad(J.deviceOrientation.gamma):0;J.screenOrientation&&THREE.Math.degToRad(J.screenOrientation);0==a&&0==l&&0==m||(i.set(-l,a,m,"YXZ"),j.setFromEuler(i),j.multiply(k),TY.ThreeContainer&&TY.ThreeContainer.quaternion.slerp(j,.2));var n=J.object.position;return b.copy(n).sub(J.target),b.applyQuaternion(d),Q.setFromVector3(b),J.autoRotate&&O===N.NONE&&e(c()),Q.theta+=R.theta,Q.phi+=R.phi,Q.theta=Math.max(J.minAzimuthAngle,Math.min(J.maxAzimuthAngle,Q.theta)),Q.phi=Math.max(J.minPolarAngle,Math.min(J.maxPolarAngle,Q.phi)),Q.makeSafe(),Q.radius*=S,Q.radius=Math.max(J.minDistance,Math.min(J.maxDistance,Q.radius)),J.target.add(T),b.setFromSpherical(Q),b.applyQuaternion(f),n.copy(J.target).add(b),J.object.lookAt(J.target),0===J.enableDamping?(R.theta*=1-J.dampingFactor,R.phi*=1-J.dampingFactor):R.set(0,0,0),S=1,T.set(0,0,0),!!(U||g.distanceToSquared(J.object.position)>P||8*(1-h.dot(J.object.quaternion))>P)&&(J.dispatchEvent(K),g.copy(J.object.position),h.copy(J.object.quaternion),U=!1,!0)}}(),this.connect=function(){E(),window.addEventListener("orientationchange",E,!1),window.addEventListener("deviceorientation",D,!1),window.addEventListener("devicemotion",F,!1),J.domElement.addEventListener("contextmenu",C,!1),J.domElement.addEventListener("mousedown",u,!1),J.domElement.addEventListener("wheel",x,!1),J.domElement.addEventListener("touchstart",z,!1),J.domElement.addEventListener("touchend",B,!1),J.domElement.addEventListener("touchmove",A,!1),window.addEventListener("keydown",y,!1)},this.dispose=function(){window.removeEventListener("orientationchange",E,!1),window.removeEventListener("deviceorientation",D,!1),window.removeEventListener("devicemotion",F,!1),J.domElement.removeEventListener("contextmenu",C,!1),J.domElement.removeEventListener("mousedown",u,!1),J.domElement.removeEventListener("wheel",x,!1),J.domElement.removeEventListener("touchstart",z,!1),
J.domElement.removeEventListener("touchend",B,!1),J.domElement.removeEventListener("touchmove",A,!1),document.removeEventListener("mousemove",v,!1),document.removeEventListener("mouseup",w,!1),window.removeEventListener("keydown",y,!1)};var G,H,I,J=this,K={type:"change"},L={type:"start"},M={type:"end"},N={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},O=N.NONE,P=1e-6,Q=new THREE.Spherical,R=new THREE.Spherical,S=1,T=new THREE.Vector3,U=!1,V=new THREE.Vector2,W=new THREE.Vector2,X=new THREE.Vector2,Y=new THREE.Vector2,Z=new THREE.Vector2,$=new THREE.Vector2,_=new THREE.Vector2,aa=new THREE.Vector2,ba=new THREE.Vector2,ca=function(){var a=new THREE.Vector3;return function(b,c){a.setFromMatrixColumn(c,0),a.multiplyScalar(-b),T.add(a)}}(),da=function(){var a=new THREE.Vector3;return function(b,c){a.setFromMatrixColumn(c,1),a.multiplyScalar(b),T.add(a)}}(),ea=function(){var a=new THREE.Vector3;return function(b,c){var d=J.domElement===document?J.domElement.body:J.domElement;if(J.object instanceof THREE.PerspectiveCamera){var e=J.object.position;a.copy(e).sub(J.target);var f=a.length();f*=Math.tan(J.object.fov/2*Math.PI/180),ca(2*b*f/d.clientHeight,J.object.matrix),da(2*c*f/d.clientHeight,J.object.matrix)}else J.object instanceof THREE.OrthographicCamera?(ca(b*(J.object.right-J.object.left)/J.object.zoom/d.clientWidth,J.object.matrix),da(c*(J.object.top-J.object.bottom)/J.object.zoom/d.clientHeight,J.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),J.enablePan=!1)}}(),fa=1e3,ga=0,ha=0,ia=0,ja=0;this.connect(),this.update()},THREE.TyOrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.TyOrbitControls.prototype.constructor=THREE.TyOrbitControls,Object.defineProperties(THREE.TyOrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(a){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!a}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(a){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!a}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(a){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!a}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(a){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!a}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(a){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!a}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(a){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=a}}}),function(){"use strict";function a(b,d){var e;if(d=d||{},this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=d.touchBoundary||10,this.layer=b,this.tapDelay=d.tapDelay||200,this.tapTimeout=d.tapTimeout||700,!a.notNeeded(b)){for(var f=["onMouse","onClick","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel"],g=this,h=0,i=f.length;h<i;h++)g[f[h]]=function(a,b){return function(){return a.apply(b,arguments)}}(g[f[h]],g);c&&(b.addEventListener("mouseover",this.onMouse,!0),b.addEventListener("mousedown",this.onMouse,!0),b.addEventListener("mouseup",this.onMouse,!0)),b.addEventListener("click",this.onClick,!0),b.addEventListener("touchstart",this.onTouchStart,!1),b.addEventListener("touchmove",this.onTouchMove,!1),b.addEventListener("touchend",this.onTouchEnd,!1),b.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(b.removeEventListener=function(a,c,d){var e=Node.prototype.removeEventListener;"click"===a?e.call(b,a,c.hijacked||c,d):e.call(b,a,c,d)},b.addEventListener=function(a,c,d){var e=Node.prototype.addEventListener;"click"===a?e.call(b,a,c.hijacked||(c.hijacked=function(a){a.propagationStopped||c(a)}),d):e.call(b,a,c,d)}),"function"==typeof b.onclick&&(e=b.onclick,b.addEventListener("click",function(a){e(a)},!1),b.onclick=null)}}var b=navigator.userAgent.indexOf("Windows Phone")>=0,c=navigator.userAgent.indexOf("Android")>0&&!b,d=/iP(ad|hone|od)/.test(navigator.userAgent)&&!b,e=d&&/OS 4_\d(_\d)?/.test(navigator.userAgent),f=d&&/OS [6-7]_\d/.test(navigator.userAgent),g=navigator.userAgent.indexOf("BB10")>0;a.prototype.needsClick=function(a){switch(a.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(a.disabled)return!0;break;case"input":if(d&&"file"===a.type||a.disabled)return!0;break;case"label":case"iframe":case"video":return!0}return/\bneedsclick\b/.test(a.className)},a.prototype.needsFocus=function(a){switch(a.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!c;case"input":switch(a.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!a.disabled&&!a.readOnly;default:return/\bneedsfocus\b/.test(a.className)}},a.prototype.sendClick=function(a,b){var c,d;document.activeElement&&document.activeElement!==a&&document.activeElement.blur(),d=b.changedTouches[0],c=document.createEvent("MouseEvents"),c.initMouseEvent(this.determineEventType(a),!0,!0,window,1,d.screenX,d.screenY,d.clientX,d.clientY,!1,!1,!1,!1,0,null),c.forwardedTouchEvent=!0,a.dispatchEvent(c)},a.prototype.determineEventType=function(a){return c&&"select"===a.tagName.toLowerCase()?"mousedown":"click"},a.prototype.focus=function(a){var b;d&&a.setSelectionRange&&0!==a.type.indexOf("date")&&"time"!==a.type&&"month"!==a.type?(b=a.value.length,a.setSelectionRange(b,b)):a.focus()},a.prototype.updateScrollParent=function(a){var b,c;if(!(b=a.fastClickScrollParent)||!b.contains(a)){c=a;do{if(c.scrollHeight>c.offsetHeight){b=c,a.fastClickScrollParent=c;break}c=c.parentElement}while(c)}b&&(b.fastClickLastScrollTop=b.scrollTop)},a.prototype.getTargetElementFromEventTarget=function(a){return a.nodeType===Node.TEXT_NODE?a.parentNode:a},a.prototype.onTouchStart=function(a){var b,c,f;if(a.targetTouches.length>1)return!0;if(b=this.getTargetElementFromEventTarget(a.target),c=a.targetTouches[0],d){if(f=window.getSelection(),f.rangeCount&&!f.isCollapsed)return!0;if(!e){if(c.identifier&&c.identifier===this.lastTouchIdentifier)return a.preventDefault(),!1;this.lastTouchIdentifier=c.identifier,this.updateScrollParent(b)}}return this.trackingClick=!0,this.trackingClickStart=a.timeStamp,this.targetElement=b,this.touchStartX=c.pageX,this.touchStartY=c.pageY,a.timeStamp-this.lastClickTime<this.tapDelay&&a.preventDefault(),!0},a.prototype.touchHasMoved=function(a){var b=a.changedTouches[0],c=this.touchBoundary;return Math.abs(b.pageX-this.touchStartX)>c||Math.abs(b.pageY-this.touchStartY)>c},a.prototype.onTouchMove=function(a){return!this.trackingClick||((this.targetElement!==this.getTargetElementFromEventTarget(a.target)||this.touchHasMoved(a))&&(this.trackingClick=!1,this.targetElement=null),!0)},a.prototype.findControl=function(a){return void 0!==a.control?a.control:a.htmlFor?document.getElementById(a.htmlFor):a.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},a.prototype.onTouchEnd=function(a){var b,g,h,i,j,k=this.targetElement;if(!this.trackingClick)return!0;if(a.timeStamp-this.lastClickTime<this.tapDelay)return this.cancelNextClick=!0,!0;if(a.timeStamp-this.trackingClickStart>this.tapTimeout)return!0;if(this.cancelNextClick=!1,this.lastClickTime=a.timeStamp,g=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,f&&(j=a.changedTouches[0],k=document.elementFromPoint(j.pageX-window.pageXOffset,j.pageY-window.pageYOffset)||k,k.fastClickScrollParent=this.targetElement.fastClickScrollParent),"label"===(h=k.tagName.toLowerCase())){if(b=this.findControl(k)){if(this.focus(k),c)return!1;k=b}}else if(this.needsFocus(k))return a.timeStamp-g>100||d&&window.top!==window&&"input"===h?(this.targetElement=null,!1):(this.focus(k),this.sendClick(k,a),d&&"select"===h||(this.targetElement=null,a.preventDefault()),!1);return!(!d||e||!(i=k.fastClickScrollParent)||i.fastClickLastScrollTop===i.scrollTop)||(this.needsClick(k)||(a.preventDefault(),this.sendClick(k,a)),!1)},a.prototype.onTouchCancel=function(){this.trackingClick=!1,this.targetElement=null},a.prototype.onMouse=function(a){return!this.targetElement||(!!a.forwardedTouchEvent||(!a.cancelable||(!(!this.needsClick(this.targetElement)||this.cancelNextClick)||(a.stopImmediatePropagation?a.stopImmediatePropagation():a.propagationStopped=!0,a.stopPropagation(),a.preventDefault(),!1))))},a.prototype.onClick=function(a){var b;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):"submit"===a.target.type&&0===a.detail||(b=this.onMouse(a),b||(this.targetElement=null),b)},a.prototype.destroy=function(){var a=this.layer;c&&(a.removeEventListener("mouseover",this.onMouse,!0),a.removeEventListener("mousedown",this.onMouse,!0),a.removeEventListener("mouseup",this.onMouse,!0)),a.removeEventListener("click",this.onClick,!0),a.removeEventListener("touchstart",this.onTouchStart,!1),a.removeEventListener("touchmove",this.onTouchMove,!1),a.removeEventListener("touchend",this.onTouchEnd,!1),a.removeEventListener("touchcancel",this.onTouchCancel,!1)},a.notNeeded=function(a){var b,d,e;if(void 0===window.ontouchstart)return!0;if(d=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]){if(!c)return!0;if(b=document.querySelector("meta[name=viewport]")){if(-1!==b.content.indexOf("user-scalable=no"))return!0;if(d>31&&document.documentElement.scrollWidth<=window.outerWidth)return!0}}if(g&&(e=navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/),e[1]>=10&&e[2]>=3&&(b=document.querySelector("meta[name=viewport]")))){if(-1!==b.content.indexOf("user-scalable=no"))return!0;if(document.documentElement.scrollWidth<=window.outerWidth)return!0}return"none"===a.style.msTouchAction||"manipulation"===a.style.touchAction||(!!(+(/Firefox\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]>=27&&(b=document.querySelector("meta[name=viewport]"))&&(-1!==b.content.indexOf("user-scalable=no")||document.documentElement.scrollWidth<=window.outerWidth))||("none"===a.style.touchAction||"manipulation"===a.style.touchAction))},a.attach=function(b,c){return new a(b,c)},"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return a}):"undefined"!=typeof module&&module.exports?(module.exports=a.attach,module.exports.FastClick=a):window.FastClick=a}(),TY.H5Sound={load:function(a,b){function c(c){++d>=a.length&&b&&b()}createjs.Sound.alternateExtensions=["mp3"],createjs.Sound.addEventListener("fileload",createjs.proxy(c,this)),createjs.Sound.registerSounds(a);var d=0},play:function(a,b,c){console.log(a);var d=createjs.Sound.play(a,createjs.Sound.INTERRUPT_ANY,0,0,b-1,1,0);null!=d&&d.playState!=createjs.Sound.PLAY_FAILED&&(console.log("playSound:"+a),d.addEventListener("complete",function(a){c&&c()}))},stop:function(a){createjs.Sound.stop(a)}},TY.Snows=function(){THREE.Group.call(this);this.speed=.3,this.time=0,this.snows=[];var a=new THREE.TextureLoader,b=new THREE.Geometry,c=[],d=[];for(d.push(a.load("assets/img//sprites/snowflake1.png")),d.push(a.load("assets/img//sprites/snowflake2.png")),d.push(a.load("assets/img//sprites/snowflake3.png")),d.push(a.load("assets/img//sprites/snowflake4.png")),i=0;i<3e3;i++){var e=new THREE.Vector3;e.x=2e3*Math.random()-1e3,e.y=2e3*Math.random()-1e3,e.z=2e3*Math.random()-1e3,b.vertices.push(e)}for(i=0;i<4;i++){var f=d[i];c[i]=new THREE.PointsMaterial({size:8,map:f,blending:THREE.AdditiveBlending,depthTest:!1,transparent:!0,opacity:.6});var g=new THREE.Points(b,c[i]);g.rotation.x=6*Math.random(),g.rotation.y=6*Math.random(),g.rotation.z=6*Math.random(),this.snows.push(g),this.add(g)}},TY.Snows.prototype=Object.assign(Object.create(THREE.Group.prototype),TY.EventDispatcher.prototype,{constructor:TY.Snows,update:function(){this.time+=.003*this.speed;for(var a=this.snows.length-1;a>=0;a--)this.snows[a].rotation.y=this.time*(a<4?a+1:-(a+1)),this.snows[a].rotation.x=this.time*(a<4?a+1:-(a+1))*.4;this.speed+=.01*(.1-this.speed)}}),TY.Light1=function(a){var b=(new THREE.TextureLoader).load("assets/img/fg.png");this.material=new THREE.ShaderMaterial({uniforms:{tShine:{type:"t",value:b},time:{type:"f",value:0},weight:{type:"f",value:0}},vertexShader:document.getElementById("light1_vertexShader").textContent,fragmentShader:document.getElementById("light1_fragmentShader").textContent}),THREE.Mesh.call(this,a,this.material)},TY.Light1.prototype=Object.assign(Object.create(THREE.Mesh.prototype),TY.EventDispatcher.prototype,{constructor:TY.Light1,update:function(a){this.material.uniforms.time.value=5e-4*(Date.now()-start),this.material.uniforms.weight.value=100,this.position.y+=.9*Math.sin(.0025*(Date.now()-start))}}),TY.Light2=function(a){this.MoveAble=!1,this._t=5e-4;var b=(new THREE.TextureLoader).load("assets/img/explosion2.png");this.material=new THREE.ShaderMaterial({uniforms:{tExplosion:{type:"t",value:b},time:{type:"f",value:0}},vertexShader:document.getElementById("light2_vertexShader").textContent,fragmentShader:document.getElementById("light2_fragmentShader").textContent}),THREE.Mesh.call(this,a,this.material)},TY.Light2.prototype=Object.assign(Object.create(THREE.Mesh.prototype),TY.EventDispatcher.prototype,{constructor:TY.Light2,update:function(a){this.material.uniforms.time.value=this._t*(Date.now()-start),this.MoveAble&&(this.position.y+=.6*Math.sin(.0025*(Date.now()-start)))}}),THREE.Mirror=function(a,b,c){function d(a){e.updateMatrixWorld(),l.setFromMatrixPosition(e.matrixWorld),m.setFromMatrixPosition(a.matrixWorld),n.extractRotation(e.matrixWorld),k.set(0,0,1),k.applyMatrix4(n),q.subVectors(l,m),q.reflect(k).negate(),q.add(l),n.extractRotation(a.matrixWorld),o.set(0,0,-1),o.applyMatrix4(n),o.add(m),r.subVectors(l,o),r.reflect(k).negate(),r.add(l),u.position.copy(q),u.up.set(0,-1,0),u.up.applyMatrix4(n),u.up.reflect(k).negate(),u.lookAt(r),u.near=a.near,u.far=a.far,u.updateMatrixWorld(),u.updateProjectionMatrix(),t.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),t.multiply(u.projectionMatrix),t.multiply(u.matrixWorldInverse),j.setFromNormalAndCoplanarPoint(k,l),j.applyMatrix4(u.matrixWorldInverse),p.set(j.normal.x,j.normal.y,j.normal.z,j.constant);var b=u.projectionMatrix;s.x=(Math.sign(p.x)+b.elements[8])/b.elements[0],s.y=(Math.sign(p.y)+b.elements[9])/b.elements[5],s.z=-1,s.w=(1+b.elements[10])/b.elements[14],p.multiplyScalar(2/p.dot(s)),b.elements[2]=p.x,b.elements[6]=p.y,b.elements[10]=p.z+1-h,b.elements[14]=p.w}THREE.Mesh.call(this,new THREE.PlaneBufferGeometry(a,b));var e=this;e.name="mirror_"+e.id,e.matrixNeedsUpdate=!0,c=c||{};var f=void 0!==c.textureWidth?c.textureWidth:512,g=void 0!==c.textureHeight?c.textureHeight:512,h=void 0!==c.clipBias?c.clipBias:0,i=void 0!==c.color?new THREE.Color(c.color):new THREE.Color(8355711),j=new THREE.Plane,k=new THREE.Vector3,l=new THREE.Vector3,m=new THREE.Vector3,n=new THREE.Matrix4,o=new THREE.Vector3(0,0,-1),p=new THREE.Vector4,q=new THREE.Vector3,r=new THREE.Vector3,s=new THREE.Vector4,t=new THREE.Matrix4,u=new THREE.PerspectiveCamera,v={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1},w=new THREE.WebGLRenderTarget(f,g,v);THREE.Math.isPowerOfTwo(f)&&THREE.Math.isPowerOfTwo(g)||(w.texture.generateMipmaps=!1);var x={uniforms:{mirrorColor:{value:new THREE.Color(8355711)},mirrorSampler:{value:null},textureMatrix:{value:new THREE.Matrix4}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 mirrorCoord;","void main() {","\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tmirrorCoord = textureMatrix * worldPosition;","\tgl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 mirrorColor;","uniform sampler2D mirrorSampler;","varying vec4 mirrorCoord;","float blendOverlay(float base, float blend) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : (1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","void main() {","\tvec4 color = texture2DProj(mirrorSampler, mirrorCoord);","\tcolor = vec4(blendOverlay(mirrorColor.r, color.r), blendOverlay(mirrorColor.g, color.g), blendOverlay(mirrorColor.b, color.b), 1.0);","\tgl_FragColor = color;","}"].join("\n")},y=THREE.UniformsUtils.clone(x.uniforms),z=new THREE.ShaderMaterial({fragmentShader:x.fragmentShader,vertexShader:x.vertexShader,uniforms:y});z.uniforms.mirrorSampler.value=w.texture,z.uniforms.mirrorColor.value=i,z.uniforms.textureMatrix.value=t,e.material=z,e.onBeforeRender=function(a,b,c){d(c),e.visible=!1;var f=a.getRenderTarget(),g=a.vr.enabled,h=a.shadowMap.autoUpdate;a.vr.enabled=!1,a.shadowMap.autoUpdate=!1,a.render(b,u,w,!0),a.vr.enabled=g,a.shadowMap.autoUpdate=h,a.setRenderTarget(f),e.visible=!0}},THREE.Mirror.prototype=Object.create(THREE.Mesh.prototype),TY.Avatar=function(a,b){THREE.SkinnedMesh.call(this,a,b);var c=this;this.NativeVs=[],this.MoveVs=[];for(var d=0;d<a.vertices.length;d++)this.NativeVs.push(a.vertices[d].clone()),this.MoveVs.push(a.vertices[d].clone());if(this.isFire=!1,this.fireTime=0,this.timeScale=1,this.mixer=new THREE.AnimationMixer(this),this.animateNameList=[],this.animateClips=[],this.morphClips=[],this.currentAction=null,this.animateClips=a.animations,a.animations)for(var d=0;d<a.animations.length;d++){var e=a.animations[d].name;c.animateNameList.push(e)}this.morphClips=THREE.AnimationClip.CreateClipsFromMorphTargetSequences(a.morphTargets,1)},TY.Avatar.prototype=Object.assign(Object.create(THREE.SkinnedMesh.prototype),TY.EventDispatcher.prototype,{constructor:TY.Avatar,setMoveVsZ:function(a){for(i=0;i<this.MoveVs.length;i++)this.MoveVs[i].z*=a},resetMoveVs:function(){for(i=0;i<this.MoveVs.length;i++)this.MoveVs[i]=this.NativeVs[i].clone()},setRandMoveVs:function(a){for(i=0;i<this.MoveVs.length;i++){var b=TY.rand(-a,a);this.MoveVs[i].x*=b,this.MoveVs[i].y*=b,this.MoveVs[i].z*=b}},playAction:function(a){var b=this.mixer.clipAction(a);return b.setEffectiveTimeScale(this.timeScale),b.paused=!1,b.play(),this.dispatchEvent("playAction",b),b},fadeAction:function(a,b){if(this.currentAction!=this.mixer.clipAction(a)){var c=this,d=this.playAction(a);this.currentAction?(console.log("crossFadeTo"),this.currentAction.crossFadeTo(d,b,!1),setTimeout(function(){c.currentAction.stop(),c.currentAction=d},1e3*b)):this.currentAction=d}},gotoAndStopAction:function(a,b){var c=this.mixer.clipAction(a);return c.setEffectiveTimeScale(this.timeScale),c.isRunning()||c.play(),c.paused=!0,c.time=.5*a.duration*b,c},gotoAndStop:function(a){this.currentAction&&(this.currentAction.paused=!0,this.currentAction.time=.5*this.currentAction.duration*a)},update:function(a){this.mixer.update(a);for(var b=.01*Date.now(),c=0;c<this.geometry.vertices.length;c++){var d=.01*Math.sin(.1*c+b);this.geometry.vertices[c].x+=.16*(this.MoveVs[c].x+d-this.geometry.vertices[c].x),this.geometry.vertices[c].y+=.16*(this.MoveVs[c].y+d-this.geometry.vertices[c].y),this.geometry.vertices[c].z+=.16*(this.MoveVs[c].z+d-this.geometry.vertices[c].z),this.geometry.verticesNeedUpdate=!0}if(this.isFire){for(var c=0;c<this.NativeVs.length;c++){var e=this.NativeVs[c],f=TY.displacement(e.x,e.y,e.z,this.fireTime/2);this.geometry.vertices[c].set(60*f.y+e.x,60*f.x+e.y,60*f.z+e.z),this.geometry.verticesNeedUpdate=!0}this.fireTime++}},applyWeight:function(a,b){this.mixer.clipAction(a).setEffectiveWeight(b)},getWeight:function(a){return this.mixer.clipAction(a).getEffectiveWeight()},pauseAll:function(){this.mixer.timeScale=0},stopAll:function(){this.mixer.stopAllAction()},showModel:function(a){this.visible=a}});var container,stats,camera,scene,renderer,cubeCamera,L1,logo,yao,avatarScale=.6,avatar,skeletonHelper,skyBox,ground,snows,composer,FilmEffect,WaterEffect,InkEffect,effectType=1,clock=new THREE.Clock,start=Date.now(),Floor=-300,raycaster,mouse=new THREE.Vector2,INTERSECTED;init(),animate();var changeAble=!0;